var XrmQuery,Filter,XQW,__extends=this&&this.__extends||function(){var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}();!function(t){function u(t,e,n,r,i,o,s){void 0===i&&(i=function(){}),void 0===s&&(s=!1);var u=new XMLHttpRequest;u.open(t,e,!s),u.setRequestHeader("Accept","application/json"),u.setRequestHeader("Content-Type","application/json; charset=utf-8"),u.setRequestHeader("OData-MaxVersion","4.0"),u.setRequestHeader("OData-Version","4.0"),o&&o(u),u.onreadystatechange=function(){4==this.readyState&&(u.onreadystatechange=null,200==this.status||204==this.status?r(this):i(new Error(this.response)))},u.send(n)}function s(t,e,n,r,i,o,s){u(t,(XQW.getApiUrl()+e).replace(/ /g,"%20"),n,r,i,o,s)}t.retrieve=function(t,e){return XQW.RetrieveRecord.Get(t,e)},t.retrieveMultiple=function(t){return XQW.RetrieveMultipleRecords.Get(t)},t.retrieveRelated=function(t,e,n){return XQW.RetrieveRecord.Related(t,e,n)},t.retrieveRelatedMultiple=function(t,e,n){return XQW.RetrieveMultipleRecords.Related(t,e,n)},t.create=function(t,e){return new XQW.CreateRecord(t,e)},t.update=function(t,e,n){return new XQW.UpdateRecord(t,e,n)},t.associateSingle=function(t,e,n,r,i){return new XQW.AssociateRecordSingle(t,e,n,r,i)},t.associateCollection=function(t,e,n,r,i){return new XQW.AssociateRecordCollection(t,e,n,r,i)},t.disassociateSingle=function(t,e,n){return XQW.DisassociateRecord.Single(t,e,n)},t.disassociateCollection=function(t,e,n,r){return XQW.DisassociateRecord.Collection(t,e,n,r)},t.deleteRecord=function(t,e){return new XQW.DeleteRecord(t,e)},t.setApiUrl=function(t){XQW.ApiUrl=t},t.setApiVersion=function(t){XQW.ApiUrl=XQW.getDefaultUrl(t)},t.request=u,t.sendRequest=s,t.promiseRequest=function(n,r,i,o){return XQW.promisifyCallback(function(t,e){return s(n,r,i,t,e,o)})}}(XrmQuery=XrmQuery||{}),function(t){function r(t){return null==t?"null":"string"==typeof t?"'"+s(t)+"'":t instanceof Date?s(t.toISOString()):s(t.toString())}function n(t,e,n){return r(t)+" "+e+" "+r(n)}function i(t,e,n){return t+"("+r(e)+", "+r(n)+")"}function o(t,e,n){return"("+t+" "+e+" "+n+")"}function e(t,n){var e=t.pop();return void 0===e?"":t.reduceRight(function(t,e){return o(e,n,t)},e)}function s(t){return encodeURI(t).replace(/'/g,"''").replace(/\+/g,"%2B").replace(/\//g,"%2F").replace(/\?/g,"%3F").replace(/#/g,"%23").replace(/&/g,"%26")}t.equals=function(t,e){return n(t,"eq",e)},t.notEquals=function(t,e){return n(t,"ne",e)},t.greaterThan=function(t,e){return n(t,"gt",e)},t.greaterThanOrEqual=function(t,e){return n(t,"ge",e)},t.lessThan=function(t,e){return n(t,"lt",e)},t.lessThanOrEqual=function(t,e){return n(t,"le",e)},t.and=function(t,e){return o(t,"and",e)},t.or=function(t,e){return o(t,"or",e)},t.not=function(t){return"not "+t},t.ands=function(t){return e(t,"and")},t.ors=function(t){return e(t,"or")},t.startsWith=function(t,e){return i("startswith",t,e)},t.contains=function(t,e){return i("contains",t,e)},t.endsWith=function(t,e){return i("endswith",t,e)},t.makeGuid=function(t){return XQW.makeTag(XQW.stripGUID(t))}}(Filter=Filter||{}),function(u){var t="OData.Community.Display.V1.FormattedValue",a="@"+t,e={type:"Prefer",value:'odata.include-annotations="'+t+'"'},c="@Microsoft.Dynamics.CRM.lookuplogicalname",l="@Microsoft.Dynamics.CRM.associatednavigationproperty",n={type:"Prefer",value:'odata.include-annotations="*"'},s="_bind$",d="_id$",p="_guid",f="_formatted",h="_lookuplogicalname",y="_navigationproperty",g="@odata.nextLink";function v(t,e){return t.substr(-e.length)==e}u.makeTag=function(t){return{__str:t,toString:function(){return this.__str}}};var m=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/;function r(t,e){if(m.test(e))return new Date(e);var n,r=t,i=v(r,a),o=v(r,c),s=v(r,l);if(i?r=r.substr(0,r.length-a.length):o?r=r.substr(0,r.length-c.length):s&&(r=r.substr(0,r.length-l.length)),n="_",r.substr(0,n.length)==n&&v(r,"_value")?(r=r.substr(1,r.length-7),r+=i?f:o?h:s?y:p):i&&(r+=f),r==t)return e;this[r]=e}function S(t){return nt("{",t)&&v(t,"}")?t.substring(1,t.length-1):t}function R(t){return JSON.parse(t.response,r)}function x(t){return 0<t.length&&"string"==typeof t[0]}function i(n){if(!Promise)throw new Error("Promises are not natively supported in this browser. Add a polyfill to use it.");return new Promise(function(t,e){n(t,e)})}u.stripGUID=S,u.promisifyCallback=i;function b(t){return function(e){t.forEach(function(t){return e.setRequestHeader(t.type,t.value)})}}var o=(w.prototype.followLink=function(t,n,r,i){var o=this;this.performingCallback(),XrmQuery.request("GET",t,null,function(t){var e=R(t);X.followLinks(e,n,r,function(t){i(t),o.callbackReceived()},o.errorCallback)},function(t){o.callbackReceived(),o.errorCallback(t)},b(r))},w.prototype.populateRecord=function(t,e,n){this.performingCallback(),_.followLinks(t,e,n,this.callbackReceived,this.errorCallback)},w.prototype.allSent=function(){if(!this.isDoingWork)return this.successCallback(this.toReturn);this.isDoneSending=!0},w.prototype.performingCallback=function(){this.missingCallbacks++,this.isDoingWork=!0},w);function w(t,e,n){var r=this;this.toReturn=t,this.successCallback=e,this.errorCallback=n,this.missingCallbacks=0,this.isDoneSending=!1,this.isDoingWork=!1,this.callbackReceived=function(){r.missingCallbacks--,r.allSent&&0==r.missingCallbacks&&r.successCallback(r.toReturn)}}var k,_=(__extends(Q,k=o),Q.followLinks=function(t,e,n,r,i){return 0==e.length?r(t):(x(e)&&(e=e.map(function(t){return{arrKey:t,linkKey:t+g}})),new Q(t,e,n,r,i))},Q);function Q(n,t,r,e,i){var o=k.call(this,n,e,i)||this;return t.forEach(function(e){var t=n[e.linkKey];t&&(delete n[e.linkKey],o.followLink(t,[],r,function(t){n[e.arrKey]=n[e.arrKey].concat(t)}))}),o.allSent(),o}var C,X=(__extends(O,C=o),O.followLinks=function(t,e,n,r,i){if(!t["@odata.nextLink"]&&(0==t.value.length||0==e.length))return r(t.value);if(0==e.length)return new O(t,[],n,r,i);if(x(e)&&(e=e.map(function(t){return{arrKey:t,linkKey:t+g}})),0==t.value.length)return new O(t,e,n,r,i);var o=t.value[0];return new O(t,e.filter(function(t){return o[t.linkKey]}),n,r,i)},O);function O(t,e,n,r,i){var o=C.call(this,t.value,r,i)||this,s=t["@odata.nextLink"];return s&&o.followLink(s,e,n,function(t){o.toReturn=o.toReturn.concat(t)}),0<e.length&&t.value.forEach(function(t){return o.populateRecord(t,e,n)}),o.allSent(),o}var A=(N.prototype.promise=function(){return i(this.execute.bind(this))},N.prototype.execute=function(t,e){void 0===e&&(e=function(){}),this.executeRaw(t,e,!0,!1)},N.prototype.executeSync=function(){var e=Error("Undefined behavior");return this.executeRaw(function(t){e=t},function(t){e=t},!0,!0),e},N.prototype.executeRaw=function(e,n,r,t){var i=this;void 0===n&&(n=function(){}),void 0===r&&(r=!1),void 0===t&&(t=!1);return XrmQuery.sendRequest(this.requestType,this.getQueryString(),this.getObjectToSend(),function(t){return r?i.handleResponse(t,e,n):e(t)},n,b(this.additionalHeaders),t)},N);function N(t){this.requestType=t,this.additionalHeaders=[],this.getObjectToSend=function(){return null}}u.Query=A;var D,T=(__extends(U,D=A),U.Get=function(t){return new U(rt(t).toString())},U.Related=function(t,e,n){return new U(rt(t).toString(),e,rt(n).toString())},U.prototype.handleResponse=function(t,e,n){X.followLinks(R(t),this.expandKeys,this.additionalHeaders,e,n)},U.prototype.getFirst=function(e,t){this.top(1),this.execute(function(t){return e(t&&0<t.length?t[0]:null)},t)},U.prototype.promiseFirst=function(){return i(this.getFirst.bind(this))},U.prototype.getQueryString=function(){var t=this.entitySetName;if(this.id&&this.relatedNav&&(t+="("+this.id+")/"+this.relatedNav),this.specialQuery)return t+this.specialQuery;var e=[];return this.explicitQuery||(this.explicitQuery={}),this.addOption(e,"select",this.selects),this.addOption(e,"expand",this.expands),this.addOption(e,"filter",this.filters),this.addOption(e,"orderby",this.ordering),this.addOption(e,"skip",this.skipAmount),this.addOption(e,"top",this.topAmount),t+(0<e.length?"?"+e.join("&"):"")},U.prototype.addOption=function(t,e,n){var r=this.explicitQuery[e],i="$"+e+"=";r?t.push(i+r):null!=n&&null!=n&&(Array.isArray(n)?0<n.length&&t.push(i+n.join(",")):t.push(i+n))},U.prototype.select=function(t){return this.selects=at(t),this},U.prototype.selectMore=function(t){return this.selects=this.selects.concat(at(t)),this},U.prototype.explicit=function(t){return this.explicitQuery=t,this},U.prototype.expand=function(t,e){var n=rt(t).toString();this.expandKeys.push(n);var r=[];return e&&r.push("$select="+at(e)),this.expands.push(n+(0<r.length?"("+r.join(";")+")":"")),this},U.prototype.filter=function(t){return this.filters=ct(t),this},U.prototype.orFilter=function(t){return this.filters?this.filters=Filter.or(this.filters,ct(t)):this.filter(t),this},U.prototype.andFilter=function(t){return this.filters?this.filters=Filter.and(this.filters,ct(t)):this.filter(t),this},U.prototype.order=function(t,e){return this.ordering.push(ct(t)+" "+e),this},U.prototype.orderAsc=function(t){return this.order(t,"asc")},U.prototype.orderDesc=function(t){return this.order(t,"desc")},U.prototype.skip=function(t){return this.skipAmount=t,this},U.prototype.top=function(t){return this.topAmount=t,this},U.prototype.maxPageSize=function(t){return this.additionalHeaders.push({type:"Prefer",value:"odata.maxpagesize="+t}),this},U.prototype.includeFormattedValues=function(){return this.additionalHeaders.push(e),this},U.prototype.includeFormattedValuesAndLookupProperties=function(){return this.additionalHeaders.push(n),this},U.prototype.useFetchXml=function(t){return this.specialQuery="?fetchXml="+encodeURIComponent(t),this},U.prototype.usePredefinedQuery=function(t,e){return this.specialQuery="?"+t+"="+e,this},U);function U(t,e,n){var r=D.call(this,"GET")||this;return r.entitySetName=t,r.id=e,r.relatedNav=n,r.specialQuery=void 0,r.selects=[],r.expands=[],r.expandKeys=[],r.ordering=[],r.skipAmount=null,r.topAmount=null,r.id=void 0!==e?S(e):e,r}u.RetrieveMultipleRecords=T;var E,W=(__extends($,E=A),$.Related=function(t,e,n){return new $(rt(t).toString(),e,rt(n).toString())},$.Get=function(t,e){return new $(rt(t).toString(),e)},$.prototype.handleResponse=function(t,e,n){_.followLinks(R(t),this.expandKeys,this.additionalHeaders,e,n)},$.prototype.select=function(t){return this.selects=at(t),this},$.prototype.selectMore=function(t){return this.selects=this.selects.concat(at(t)),this},$.prototype.expand=function(t,e,n){var r=rt(t).toString();this.expandKeys.push(r);var i=[];return e&&i.push("$select="+at(e)),n&&(n.top&&i.push("$top="+n.top),n.orderBy&&i.push("$orderby="+ct(n.orderBy)+" "+(2!=n.sortOrder?"asc":"desc")),n.filter&&i.push("$filter="+ct(n.filter))),this.expands.push(r+(0<i.length?"("+i.join(";")+")":"")),this},$.prototype.getQueryString=function(){var t=this.entitySetName+"("+this.id+")",e=[];return 0<this.selects.length&&e.push("$select="+this.selects.join(",")),0<this.expands.length&&e.push("$expand="+this.expands.join(",")),this.relatedNav&&(t+="/"+this.relatedNav),t+(0<e.length?"?"+e.join("&"):"")},$.prototype.includeFormattedValues=function(){return this.additionalHeaders.push(e),this},$.prototype.includeFormattedValuesAndLookupProperties=function(){return this.additionalHeaders.push(n),this},$);function $(t,e,n){var r=E.call(this,"GET")||this;return r.entitySetName=t,r.id=e,r.relatedNav=n,r.selects=[],r.expands=[],r.expandKeys=[],r.id=S(e),r}u.RetrieveRecord=W;var G,j=(__extends(P,G=A),P.prototype.handleResponse=function(t,e,n){var r=t.getResponseHeader("OData-EntityId");r?e(r.substr(-37,36)):n(new Error("No valid OData-EntityId found in header."))},P.prototype.setData=function(t){return this.record=t,this},P.prototype.getQueryString=function(){return this.entitySetName},P);function P(t,e){var n=G.call(this,"POST")||this;return n.record=e,n.getObjectToSend=function(){return JSON.stringify(lt(n.record))},n.entitySetName=rt(t).toString(),n}u.CreateRecord=j;var q,F=(__extends(H,q=A),H.prototype.handleResponse=function(t,e){e()},H.prototype.setId=function(t){return this.id=S(t),this},H.prototype.getQueryString=function(){return this.entitySetName+"("+this.id+")"},H);function H(t,e){var n=q.call(this,"DELETE")||this;return n.id=e,n.id=void 0!==e?S(e):e,n.entitySetName=rt(t).toString(),n}u.DeleteRecord=F;var I,L=(__extends(K,I=A),K.prototype.handleResponse=function(t,e){e()},K.prototype.setData=function(t,e){return this.id=S(t),this.record=e,this},K.prototype.getQueryString=function(){return this.entitySetName+"("+this.id+")"},K);function K(t,e,n){var r=I.call(this,"PATCH")||this;return r.id=e,r.record=n,r.getObjectToSend=function(){return JSON.stringify(lt(r.record))},r.id=void 0!==e?S(e):e,r.entitySetName=rt(t).toString(),r}u.UpdateRecord=L;var M,V=(__extends(z,M=A),z.prototype.handleResponse=function(t,e){e()},z.prototype.setData=function(t,e){return this.id=S(t),this.record=e,this},z.prototype.getQueryString=function(){return this.entitySetName+"("+this.id+")/"+this.relation+"/$ref"},z);function z(t,e,n,r,i){var o=M.call(this,"PUT")||this;return o.id=e,o.getObjectToSend=function(){return JSON.stringify(lt(o.record))},o.entitySetName=rt(t).toString(),o.id=void 0!==e?S(e):e,o.entitySetNameTarget=rt(n).toString(),o.targetId=void 0!==r?S(r):r,o.relation=rt(i).toString(),o.record={},o.record["_id$"+o.entitySetNameTarget]=o.targetId,o}u.AssociateRecordSingle=V;var J,Z=(__extends(B,J=A),B.prototype.handleResponse=function(t,e){e()},B.prototype.setData=function(t,e){return this.id=S(t),this.record=e,this},B.prototype.getQueryString=function(){return this.entitySetName+"("+this.id+")/"+this.relation+"/$ref"},B);function B(t,e,n,r,i){var o=J.call(this,"POST")||this;return o.id=e,o.getObjectToSend=function(){return JSON.stringify(lt(o.record))},o.entitySetName=rt(t).toString(),o.id=void 0!==e?S(e):e,o.entitySetNameTarget=rt(n).toString(),o.targetId=void 0!==r?S(r):r,o.relation=rt(i).toString(),o.record={},o.record["_id$"+o.entitySetNameTarget]=o.targetId,o}u.AssociateRecordCollection=Z;var Y,tt=(__extends(et,Y=A),et.Single=function(t,e,n){return new et(rt(t).toString(),e,rt(n).toString())},et.Collection=function(t,e,n,r){return new et(rt(t).toString(),e,rt(n).toString(),r)},et.prototype.handleResponse=function(t,e){e()},et.prototype.setId=function(t){return this.id=S(t),this},et.prototype.getQueryString=function(){return null==this.targetId?this.entitySetName+"("+this.id+")/"+this.relation+"/$ref":this.entitySetName+"("+this.id+")/"+this.relation+"("+this.targetId+")/$ref"},et);function et(t,e,n,r){var i=Y.call(this,"DELETE")||this;return i.id=e,i.targetid=r,i.entitySetName=t,i.id=void 0!==e?S(e):e,i.relation=n,i.targetId=void 0!==r?S(r):r,i}function nt(t,e){return 0===e.lastIndexOf(t,0)}function rt(t,e){return t(function(t,e){var n,r=function(t){var e=t.toString().match(it);if(!e)throw new Error("XrmQuery: Unable to properly parse function: "+t.toString());return{arg:e[1],body:e[2]}}(t),i=function(t){return new RegExp("\\b"+t+"\\.([a-zA-Z_$][0-9a-zA-Z_$]*)(\\.([a-zA-Z_$][0-9a-zA-Z_$]*))?","g")}(r.arg),o=e||function(t){return t},s={};for(;null!=(n=i.exec(r.body));)s[n[1]]||(s[n[1]]=u.makeTag(o(n[1]))),n[3]&&(s[n[1]][n[3]]=u.makeTag(n[1]+"/"+o(n[3])));return s}(t,e))}u.DisassociateRecord=tt;var it=/(?:function)*\s*\(?([a-zA-Z0-9_]+)\)?(?:\s?=>\s?\{?|\s?\{)+([\s\S]*[^\}])\}?$/m;u.ApiUrl=null;var ot="9.2";function st(t){return function(){var t=function(){try{if(GetGlobalContext&&GetGlobalContext().getClientUrl)return GetGlobalContext().getClientUrl()}catch(t){}return}();if(void 0!==t)return t;if(void 0!==(t=function(){try{if(Xrm&&Xrm.Utility&&Xrm.Utility.getGlobalContext)return Xrm.Utility.getGlobalContext().getClientUrl()}catch(t){}try{if(window&&window.parent&&window.parent.window){var t=window.parent.window;if(t&&t.Xrm&&t.Xrm.Utility&&t.Xrm.Utility.getGlobalContext)return t.Xrm.Utility.getGlobalContext().getClientUrl()}}catch(t){}return}()))return t;if(void 0!==(t=function(){try{if(Xrm&&Xrm.Page&&Xrm.Page.context)return Xrm.Page.context.getClientUrl()}catch(t){}return}()))return t;throw new Error("Context is not available.")}()+"/api/data/v"+t+"/"}function ut(t){var e=t.match(/_guid$/);return e?"_"+t.substr(0,e.index)+"_value":t}function at(t){return ct(t).map(function(t){return t.toString()})}function ct(t){return rt(t,ut)}function lt(e){if(e instanceof Date)return e;if("string"==typeof e&&nt("{",e)&&v(e,"}"))return e.substring(1,e.length-1);if(e instanceof Array){var n=[];return e.forEach(function(t,e){return n[e]=lt(t)}),n}if(e instanceof Object){var r={};return Object.keys(e).forEach(function(t){return function(t,e,n){{var r,i,o;0<=t.indexOf(s)?0<=(r=t.indexOf(s))&&(i=t.substr(r+s.length),n[t.substr(0,r)+"@odata.bind"]="/"+i+"("+e+")"):0<=t.indexOf(d)?0<=(r=t.indexOf(d))&&(i=t.substr(r+d.length),o=st(ot),n[t.substr(0,r)+"@odata.id"]=""+o+i+"("+e+")"):n[t]=e}}(t,lt(e[t]),r)}),r}return e}u.getDefaultUrl=st,u.getApiUrl=function(){return null===u.ApiUrl&&(u.ApiUrl=st(ot)),u.ApiUrl}}(XQW=XQW||{});
